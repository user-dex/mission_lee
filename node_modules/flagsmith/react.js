!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["flagsmith-react"]={},t.React)}(this,(function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(e),i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i.apply(this,arguments)},o=function(){function t(){this.e={}}return t.prototype.generateCallbackId=function(){return Math.random().toString(36).substring(7)},t.prototype.on=function(t,e,n){var r=this,i=this.e||(this.e={}),o=this.generateCallbackId(),a={id:o,fn:e,ctx:n};(i[t]||(i[t]=[])).push(a);return function(){r.off(t,o)}.bind(this)},t.prototype.once=function(t,e,n){var r=this,i=this.generateCallbackId();function o(){r.off(t,i),e.apply(n,arguments)}return o._=e,this.on(t,o,n)},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=((this.e||(this.e={}))[t]||[]).slice(),i=r.length,o=0;o<i;o++)r[o].fn.apply(r[o].ctx,e);return this},t.prototype.off=function(t,e,n){var r=this.e||(this.e={}),i=r[t],o=[];if(i&&e)for(var a=0,u=i.length;a<u;a++)("function"==typeof e&&i[a].fn!==e||"string"==typeof e&&i[a].id!==e)&&o.push(i[a]);return o.length?r[t]=o:delete r[t],this},t}(),a=new o,u=e.createContext(null),s=function(t){var n=e.useRef(t);return n.current||(n.current=t),n.current},l=function(t){if("string"==typeof t)return[t];if("object"==typeof t&&t.hasOwnProperty("length"))return t;throw new Error("Flagsmith: please supply an array of strings or a single string of flag keys to useFlags")},f=function(t,e,n){return void 0===n&&(n=[]),e.map((function(e){return"".concat(t.getValue(e)).concat(t.hasFeature(e))})).concat(n.map((function(e){return"".concat(t.getTrait(e))}))).join(",")};t.FlagsmithContext=u,t.FlagsmithProvider=function(t){var n=t.flagsmith,o=t.options,s=t.serverState,l=t.children,f=e.useRef(!0);return n&&!(null==n?void 0:n._trigger)&&(n._trigger=function(){n.log("React - trigger event received"),a.emit("event")}),n&&!(null==n?void 0:n._triggerLoadingState)&&(n._triggerLoadingState=function(){a.emit("loading_event")}),s&&!n.initialised&&n.setState(s),f.current&&(f.current=!1,o&&n.init(i(i({},o),{state:o.state||s,onChange:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.onChange&&o.onChange.apply(o,t)}}))),r.default.createElement(u.Provider,{value:n},l)},t.useFlags=function(t,n){void 0===n&&(n=[]);var r=e.useRef(!0),i=s(l(t)),o=s(l(n)),c=e.useContext(u),g=e.useState(f(c,i,o)),h=g[0],d=g[1],p=e.useCallback((function(){var t=f(c,i,o);t!==h&&(null==c||c.log("React - useFlags flags and traits have changed"),d(t))}),[h]),v=e.useRef(a.once("event",p));return r.current&&(r.current=!1,null==c||c.log("React - Initialising event listeners")),e.useEffect((function(){return function(){var t;null===(t=v.current)||void 0===t||t.call(v)}}),[]),e.useMemo((function(){var t={};return i.map((function(e){t[e]={enabled:c.hasFeature(e),value:c.getValue(e)}})).concat(null==o?void 0:o.map((function(e){t[e]=c.getTrait(e)}))),t}),[h])},t.useFlagsmith=function(){var t=e.useContext(u);if(!t)throw new Error("useFlagsmith must be used with in a FlagsmithProvider");return t},t.useFlagsmithLoading=function(){var t=e.useContext(u),n=e.useState(null==t?void 0:t.loadingState),r=n[0],i=n[1],o=e.useState(!1),s=o[0],l=o[1],f=e.useRef(s),c=e.useCallback((function(){i(null==t?void 0:t.loadingState)}),[t]);return f.current||(a.on("loading_event",c),f.current=!0),e.useEffect((function(){return!s&&t.initialised&&(a.on("loading_event",c),l(!0)),function(){s&&a.off("loading_event",c)}}),[t,s,c]),r},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=react.js.map
